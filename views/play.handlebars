<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--Plugin CSS file with desired skin-->
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.3.0/css/ion.rangeSlider.min.css"/>

    <!-- Backbutton  -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!--jQuery-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!--Plugin JavaScript file-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.3.0/js/ion.rangeSlider.min.js"></script>

    <link href="../../css/dcount.css" rel="stylesheet">

    <style>
        .container {
            position: relative;
            width: 300px;
            height: 200px;
            border-radius: 5px;
            border: 1px solid red;
            overflow: hidden;
        }
    </style>

    <title>dancecount</title>

</head>

<body>
<a id="back-btn" class="btn-floating btn-large waves-effect waves-light red"><i
        class="material-icons">arrow_back</i></a>
<div id="body" align="center">

    <h1 align="center">Dance Notes</h1>


    <div id="imageDiv" class="container"> <!-- THE IMAGE GALLERY -->
        <img id="screen"
             src="https://dhggywfvre0o8.cloudfront.net/app/uploads/2017/11/22153252/Typeform-Blog-BlackFriday-Cover-AskAwesomely.jpg" width="302" height="202"/>
    </div>


    <p></p>
    <!-- PUT THE AUDIO HERE -->
    <audio id="sample" src="../../niceforwhat.mp3" controls preload ontimeupdate="audio()">
        <p>Your browser does not support the audio element</p>
    </audio>

    <!-- THE JAVASCRIPT FOR THE IMAGE GALLERY -->


    <!-- LOOP TOGGLE HTML -->
    <p></p>
    <div class="loopbutton">
        <label class="switch">
            <input type="checkbox" id="check">
            <span class="slider round" id="loopslider"></span>
        </label>
        Loop
    </div>

    <p></p>

    <p>Select section to loop from (in seconds): </p>
    <!-- LOOP SECTION 2 HANDLE SLIDER RANGE -->
    <div style="width: 300px">
        <input type="text" class="js-range-slider" name="my_range" value=""/>
    </div>

    <script>
        $(".js-range-slider").ionRangeSlider({
            type: "double"
        });

        let my_range = $(".js-range-slider").data("ionRangeSlider");
        //  Update range slider content (this will change handles positions)
        myaudio = document.getElementById("sample");
        my_range.update({
            min: 0,
            from: 0
        });
        myaudio.addEventListener('loadedmetadata', function () {
            my_range.update({
            max: Math.floor(myaudio.duration),
            from: 0,
            to: Math.floor(myaudio.duration)
        });
        });
    </script>

    <!-- AUDIO LISTENER FUNCTION (LOOP BETWEEN SPECIFIC TIME & DISPLAYS IMAGE) -->
    <script>
        var myaudio = document.getElementById("sample");
        var cuesArray = new Array(400).fill('../../Sana-04.jpg');
        // var cuesArray = new Array(400).fill('../../Sana-04.jpg');


        myaudio.addEventListener('loadedmetadata', function () {

            {{#each cues}}
                for (let i = {{start}}; i <={{end}}; i++) {
                    cuesArray[i] = "{{file}}";
                }
            {{/each}}
        });


        function audio() {
            // for (let i = 0; i < cuesArray.length; i++) {
            //     console.log(cuesArray[i])
            // }
            var myaudio = document.getElementById("sample");

            var img = document.getElementById("screen");

            if (document.getElementById("sample").currentTime < cuesArray.length) {
                img.src = cuesArray[Math.floor(document.getElementById("sample").currentTime)];
                //console.log(Math.floor(document.getElementById("sample").currentTime));

                //document.getElementById('imageDiv').appendChild(img);
            }


            if (myaudio.loop == true) {
                if (document.getElementById("sample").currentTime >= $('.js-range-slider').data("to")) {
                    document.getElementById("sample").currentTime = $('.js-range-slider').data("from")
                }

                if (document.getElementById("sample").currentTime <= $('.js-range-slider').data("from")) {
                    document.getElementById("sample").currentTime = $('.js-range-slider').data("from")
                }
            }


        }
    </script>


    <!--
    Click to select section to loop: <input onclick="this.value=Math.floor(myaudio.currentTime)" type="button" value=0 id="myButton1"></input> -
    <input onclick="this.value=Math.floor(myaudio.currentTime)" type="button" value=0 id="myButton2"></input> (seconds)
  -->

    <!-- LOOP TOGGLE JAVASCRIPT? -->

    <script>
        myaudio = document.getElementById("sample");
        var slider = document.getElementById("check");
        slider.oninput = function () {
            if (myaudio.loop === false) {
                myaudio.loop = true
            }
            else {
                myaudio.loop = false
            }
        };
    </script>

    <p></p>

    <!-- SPEED OF AUDIO SLIDER -->
    <div class="slidecontainer">
        <input type="range" min="1" max="200" value="100" class="slider" id="myRange">
        <p>Speed: <span id="demo"></span>%</p>
    </div>

    <script>
        var slider = document.getElementById("myRange");
        var output = document.getElementById("demo");
        output.innerHTML = slider.value;
        slider.oninput = function () {
            output.innerHTML = this.value;
            myaudio.playbackRate = this.value / 100;
        }
    </script>


</div>
<script src="../../js/dcount.js"></script>


</body>
</html>